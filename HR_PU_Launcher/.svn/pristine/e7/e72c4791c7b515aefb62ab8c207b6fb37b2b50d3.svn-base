package com.mdstec.android.tpeg.decoder;

import android.os.Environment;

/**
 * Tpeg basic class
 * @author mjCho
 *
 */
public class Tpegdec {
	
		
	// Service Provider
	public static final int TST_KBS = 0;
	public static final int TST_MBC = 1;
	public static final int TST_SBS = 2;
	public static final int TST_YTNDMB = 3;
	
	// Tpeg binary file save path
	public static final String giniEnvPath  = Environment.getExternalStorageDirectory().getAbsolutePath() + "/data/TPEG";
	public static final String tpegRootPath = Environment.getExternalStorageDirectory().getAbsolutePath() + "/data/TPEG";						// 중요 :  단말에 맞는 저장위치 설정
	public static final String tpegSaveDataPath = tpegRootPath + "/TPEGDATA";
	public static final String tpegBackupDataPath = tpegRootPath + "/BACKUPDATA";
	
	// Tpeg Interface
	/**
	 * MSC Packet을 TDC 디코더에 넣는 메소드
	 * @param pData : RAW DATA
	 */
	public static native void fillMSCData(byte[] pData);
	/**
	 * 
	 * @param serviceProvider 방송사
	 * @param tpegDataPath TPEGDATA 저장위치
	 * @param tpegBackupDataPath TPEGDATA 백업위치(아틀란위즈맵만 사용하지만  tpeg initialize를 위해선 반드시 입력
	 * @param tpegEnvPath
	 * @return
	 *  0: 성공, 1: TDC decoder 초기화 실패, 2: TPEG decoder 초기화 실패, 3 : KBS, 4:TDCQueue
	 */
	public static native int initTpeg(int serviceProvider, String tpegDataPath, String tpegBackupDataPath, String tpegEnvPath);
	/**
	 * 
	 * @return
	 * 0: 성공 1: TDC decoder 언로드 실패 2: TPEG decoder 언로드 실패
	 */
	public static native int unInitTpeg();
	/**
	 * 
	 * @return
	 * 0: 성공, 1: TPEG decoder 시작 실패, 2: TDC decoder 시작 실패, 3: TDC decoder 초기화 실패
	 */
	public static native int startTpeg();
	/**
	 * 
	 * @return
	 * 0: 성공, 1: TDC decoder 정지 실패, 2: TPEG decoder 정지 실패
	 */
	public static native int stopTpeg();


	/**
     * @param sequence : sequence는 0보다 크거나 같아야 함
	 * @return
     * 0 : 성공, 1: 실패
     */
     public static native int sdiReset(int sequence);

	
	private static TpegdecListener listener = null;
	public static void registerListener(TpegdecListener listener) {
		Tpegdec.listener = listener;
		
	}
	
	/**
	 *  TPEG decoder 콜백메소드
	 * @param data : TPEG decoder에서 넘어오는 Binary 데이타(CTT,RTM,SDI 등)
	 * @param eventCode : CTT, RTM, SDI등을 표시하는 이벤트 코드
	 * @param subType : TPEG ETC 데이터를 구별해주기 위한 서브코드
	 */
	private static void eventCallback(byte[] data, int eventCode, int subType)
	{
		if(listener != null) {
			listener.eventCallback(data, eventCode, subType);
		}
	}
	
	/*
	 * libTpegdec_tdc.so	
	 */
	static{
		System.loadLibrary("Tpegdec_tdc");
	}

}
