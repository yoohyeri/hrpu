package android_serialport_api;

import java.util.ArrayList;

import android.util.Log;

public class HMSUartProtocol {

	//value
	public static final byte SOP = (byte)0xAA;
	public static final byte EOP = (byte)0x55;
	public static final byte TYPE = (byte)0x01;
	
	//index
	public static final byte INDEX_STOP = 0;
	public static final byte INDEX_TYPE = 1;
	public static final byte INDEX_LEN = 2;
	public static final byte INDEX_CMD1 = 3;
	public static final byte INDEX_CMD2 = 4;
	public static final byte INDEX_DATA = 5;
	
	//len
	public static final byte PACKET_TOTAL_LEN = 7; // 8(SOP ~ EOP) - 1(DATA)
	public static final byte PACKET_CMD_TO_CS = 3; // CMD1, CMD2, CS
	public static final byte CS_MIN = 4; // LEN, CMD DATA(1byte)
	
	//cmd
	public static final byte CMD1_VALUE = 1;
	public static final byte CMD2_SET_SERIAL = 0;
	public static final byte CMD2_SET_CAS_ID = 1;
	public static final byte CMD2_SET_REPORT = 2;
	
	public static final byte CMD2_GET_SERIAL = (byte)0x20;
	public static final byte CMD2_GET_CAS_ID = (byte)0x21;
	
	public static final byte CMD2_SET_CONNECT = (byte)0xAA;
	
	public static final byte CMD_VALUE_SUCCESS = 0;
	public static final byte CMD_VALUE_FAIL = 1;
	
	public static int MakeCRC(ArrayList<Byte> buf, int _size) {
		int ret = 0;
	    int sum = 0;
	    Log.d("debug", " 11 CRC size : " + _size + "   len : ");
	    if(buf.size() < CS_MIN)
	    	return -1;
	    
//	    for(int i = 0; i < buf.get(_size); i++)
	    for(int i = 0; i < _size; i++) {
	    	sum = (sum + (byte)buf.get(i+INDEX_LEN)) & 0xFF;
	    }

	    ret = ~(sum) & 0xFF;
	    return (byte)ret;
	}
	
	public static byte MakeCRC(byte []buf, byte _size) {
		int ret = 0;
	    int sum = 0;
	    int len = byteToint(_size);
	    Log.d("debug", "CRC size : " + _size + "   len : " + len);
	    if(len < CS_MIN) {
	    	Log.d("debug", "CRC return");
	    	return -1;
	    }
	    
	    for(int i = 0; i < len; i++) {
	    	sum = (sum + (byte)buf[i+INDEX_LEN]) & 0xFF;
	    	Log.d("debug", "CRC : " + (byte)buf[i+INDEX_LEN] + "      sum : " + sum);
	    }

	    ret = ~(sum) & 0xFF;
	    
	    Log.d("debug", "CRC SUM : " + ret);
	    return (byte)ret;
	}
	
	public static int byteToint(byte _byte) {
		return _byte & 0xff;
	}
	
	public static final byte CMD1_CAS_SERIAL = (byte)0x01;
	public static final byte CMD2_CAS = (byte)0x09;
	public static final byte CMD2_SERIAL = (byte)0x0A;
	
}
